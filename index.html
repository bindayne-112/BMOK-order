<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V√≤ng Quay May M·∫Øn - √îng K√≤i</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('bg.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 400px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .logo {
      width: 100px;
      margin-bottom: 10px;
    }
    #wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 10px solid #ff6600;
      background: conic-gradient(
        #ffcc80 0deg 45deg, #fff59d 45deg 90deg,
        #81c784 90deg 135deg, #4db6ac 135deg 180deg,
        #ffcc80 180deg 225deg, #fff59d 225deg 270deg,
        #81c784 270deg 315deg, #4db6ac 315deg 360deg
      );
      margin: 0 auto;
      position: relative;
      transition: transform 2s cubic-bezier(0.33, 1, 0.68, 1);
    }
    .pointer {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid red;
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }
    .btn {
      margin-top: 20px;
      background-color: #ff6600;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 18px;
      cursor: pointer;
    }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      display: none;
      z-index: 999;
    }
    input {
      padding: 10px;
      width: 100%;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png" class="logo" alt="Logo">
    <h2>üéâ V√≤ng Quay B√°nh M√¨ May M·∫Øn üéâ</h2>
    <input type="tel" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i Zalo" maxlength="10" />
    <div class="pointer"></div>
    <div id="wheel"></div>
    <button class="btn" onclick="handlePlay()">Quay Ngay</button>
  </div>

  <div class="popup" id="popup">
    <h2 id="popupTitle"></h2>
    <p id="popupMessage"></p>
    <button class="btn" onclick="closePopup()">ƒê√≥ng</button>
  </div>

  <script>
    function buildUrl(phone) {
      const baseUrl = "https://script.google.com/macros/s/AKfycbzmDx_22lpkyLLhtvZjOJj6ygyB4kwdK76TVbBpkmovLUQ96BjQsbEkB4USfQxr3V3Lew/exec";
      const fullUrl = `${baseUrl}?sdt=${phone}`;
      return "https://api.allorigins.win/raw?url=" + encodeURIComponent(fullUrl);
    }

    let spinning = false;

    function handlePlay() {
      const phone = document.getElementById("phone").value.trim();
      if (!/^0\d{9}$/.test(phone)) {
        showPopup("L·ªói", "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá (10 s·ªë b·∫Øt ƒë·∫ßu b·∫±ng 0).");
        return;
      }
      if (spinning) return;
      spinning = true;

      const deg = Math.floor(360 * 3 + Math.random() * 360);
      document.getElementById("wheel").style.transform = `rotate(${deg}deg)`;

      setTimeout(() => {
        fetch(buildUrl(phone))
          .then(res => res.json())
          .then(data => {
            let title = "Kh√¥ng tr√∫ng";
            let msg = "Ch∆∞a may m·∫Øn, h√£y th·ª≠ l·∫°i v√†o ng√†y mai.";
            if (data.status === "trung") {
              title = "üéâ Tr√∫ng Th∆∞·ªüng!";
              msg = "B·∫°n ƒë√£ nh·∫≠n 1 ·ªï b√°nh m√¨ mi·ªÖn ph√≠!";
            } else if (data.status === "played") {
              title = "Oops!";
              msg = "B·∫°n ƒë√£ ch∆°i h√¥m nay r·ªìi. H√£y quay l·∫°i v√†o ng√†y mai nh√©.";
            } else if (data.status === "het") {
              title = "H·∫øt qu√†";
              msg = "H√¥m nay ƒë√£ ƒë·ªß s·ªë ng∆∞·ªùi tr√∫ng th∆∞·ªüng. H·∫πn b·∫°n quay l·∫°i v√†o ng√†y mai!";
            }
            showPopup(title, msg);
            spinning = false;
          })
          .catch(err => {
            showPopup("L·ªói", "Kh√¥ng th·ªÉ k·∫øt n·ªëi, vui l√≤ng th·ª≠ l·∫°i sau.");
            spinning = false;
          });
      }, 2200);
    }

    function showPopup(title, msg) {
      document.getElementById("popupTitle").innerText = title;
      document.getElementById("popupMessage").innerText = msg;
      document.getElementById("popup").style.display = "block";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }
  </script>
</body>
</html>
